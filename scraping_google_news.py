# -*- coding: utf-8 -*-
"""Scraping_Google_news.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1_kVB3rRwjAHZvw6WV1kwkewRoTkJeWs_
"""

from urllib.request import Request, urlopen
from bs4 import BeautifulSoup
import requests

class NewsScraper:
    def __init__(self, search_url, output_file):
        self.search_url = search_url
        self.output_file = output_file
        self.headers = {'User-Agent': 'Mozilla/5.0'}

    def fetch_webpage(self):
        req = Request(self.search_url, headers=self.headers)
        self.webpage = urlopen(req).read()

    def parse_and_write_news(self):
        with requests.Session() as c:
            soup = BeautifulSoup(self.webpage, 'html5lib')
            with open(self.output_file, "a") as document:
                document.write("Headline,Content,Link\n")
                for item in soup.find_all('div', attrs={'class': 'Gx5Zad fP1Qef xpd EtOod pkphOe'}):
                    raw_link = item.find('a', href=True)['href']
                    link = (raw_link.split("/url?q=")[1]).split('&sa=U&')[0]
                    title = (item.find('div', attrs={'class': 'BNeawe vvjwJb AP7Wnd'}).get_text())
                    description = (item.find('div', attrs={'class': 'BNeawe s3v9rd AP7Wnd'}).get_text())

                    title = title.replace(",", "")
                    description = description.replace(",", "")

                    document.write(f"{title}, {description}, {link} \n")

    def scrape(self):
        self.fetch_webpage()
        self.parse_and_write_news()
